{% from "bootstrap5/form.html" import render_form %}
{% include "header.html" %}

<header class="masthead" style="background-image: url('../static/assets/img/wf-bg-v5.png')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="page-heading">
          {% if is_edit %}
          <h1>Edit Post</h1>
          {% else %}
          <h1>New Post</h1>
          {% endif %}
          <span class="page-subheading">You're going to make a great post!</span>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="mb-4">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        {{ render_form(form, novalidate=True, enctype="multipart/form-data", button_map={"submit": "primary"}) }}
      </div>
    </div>
  </div>
</main>

<script>
  (function () {
    const el = document.querySelector('textarea[name="body"]');
    if (!el) return;

    function initEditor() {
      const Editor = (window.CKEDITOR && CKEDITOR.ClassicEditor) || window.ClassicEditor;
      if (!Editor) { console.error('CKEditor not found after load'); return; }

      Editor.create(el, {
        // Keep Base64UploadAdapter (we convert on save in backend)
        removePlugins: [
          'CloudServices','EasyImage','ExportPdf','ExportWord','WProofreader','AIAssistant',
          'CKBox','CKBoxUtils','CKBoxImageEdit',
          'CKFinder','CKFinderUploadAdapter',
          'RealTimeCollaborativeComments','RealTimeCollaborativeTrackChanges',
          'RealTimeCollaborativeRevisionHistory','PresenceList','Comments',
          'TrackChanges','TrackChangesData','RevisionHistory',
          'MultiLevelList','TableOfContents','FormatPainter','Template',
          'SlashCommand','PasteFromOfficeEnhanced','CaseChange',
          'Pagination','DocumentOutline'
        ],
        toolbar: {
          items: [
            'undo','redo','|',
            'heading','|',
            'bold','italic','link','|',
            'bulletedList','numberedList','|',
            'imageInsert','blockQuote','codeBlock'
          ]
        },
        image: {
          insert: { integrations: ['upload', 'url'] },
          toolbar: [
            'imageStyle:alignLeft','imageStyle:alignCenter','imageStyle:alignRight',
            '|','toggleImageCaption','linkImage','imageTextAlternative'
          ],
          styles: [ 'alignLeft','alignCenter','alignRight' ]
        }
      })
      .then(() => console.log('CKEditor ready âœ…'))
      .catch(err => console.error('CKEditor init error:', err));
    }

    // Lazy-load only on this page
    if (!window.CKEDITOR && !window.ClassicEditor) {
      const s = document.createElement('script');
      s.src = 'https://cdn.ckeditor.com/ckeditor5/41.4.2/super-build/ckeditor.js';
      s.defer = true;
      s.onload = initEditor;
      document.head.appendChild(s);
    } else {
      initEditor();
    }
  })();
</script>





{% include "footer.html" %}