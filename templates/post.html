{% include "header.html" %}

<!-- Page Header -->
<header class="masthead" style="background-image: url('{{ post.img_url }}')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-12 col-md-11 col-lg-9 col-xl-9">
        <div class="post-heading">
          <h1>{{ post.title }}</h1>
          <h2 class="subheading">{{ post.subtitle }}</h2>
          <span class="meta">
            Posted by
            <a href="/about#author"
               class="wf-author"
               data-author="{{ post.author.name }}">{{ post.author.name }}</a>
            on {{ post.date }}
          </span>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Post Content -->
<article>
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-12 col-md-11 col-lg-9 col-xl-9">
        <div class="post-body ck-content">
          {{ post.body|safe }}
        </div>

        <!-- Minimal Sources (collapsible) -->
        <div class="wf-sources my-5">
          <button
            class="btn btn-outline-secondary w-100 d-flex justify-content-between align-items-center"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#sources-{{ post.id }}"
            aria-expanded="false"
            aria-controls="sources-{{ post.id }}">
            <span>ðŸ”— Sources{% if post.sources %} ({{ post.sources|length }}){% endif %}</span>
            <span class="small">â–¼</span>
          </button>

          <div id="sources-{{ post.id }}" class="collapse mt-3">
            {% if post.sources and post.sources|length > 0 %}
              <ul class="list-unstyled mb-0 small">
                {% for s in post.sources %}
                  <li class="mb-2">
                    {% if s.url %}
                      <a href="{{ s.url }}" target="_blank" rel="nofollow noopener">{{ s.label }}</a>
                    {% else %}
                      {{ s.label }}
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <div class="text-muted small">No sources provided for this article.</div>
            {% endif %}
          </div>
        </div>

        {% if current_user.id == 1 %}
        <div class="d-flex justify-content-end mb-4">
          <a class="btn btn-primary float-right" href="{{ url_for('edit_post', post_id=post.id) }}">Edit Post</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</article>

{% include "footer.html" %}
