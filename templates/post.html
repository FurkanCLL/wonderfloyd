{% set page_title = "WonderFloyd  - " ~ post.title %}
{% set meta_description = post.subtitle %}

{# Canonical link for this article #}
{% set canonical_url = url_for('show_post', slug=post.slug, _external=True) %}

{# Open Graph specific for posts #}
{% set og_title = post.title %}
{% set og_description = post.subtitle %}
{% set og_image = post.img_url %}
{% set og_type = "article" %}
{% set og_url = url_for('show_post', slug=post.slug, _external=True) %}

{% include "header.html" %}

<!-- Page Header -->
<header class="masthead" style="background-image: url('{{ post.img_url }}')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-12 col-md-11 col-lg-9 col-xl-9">
        <div class="post-heading">
          <h1>{{ post.title }}</h1>
          <h2 class="subheading">{{ post.subtitle }}</h2>
          <span class="meta">
            Posted by
            <a href="/about#author"
               class="wf-author"
               data-author="{{ post.author.name }}">{{ post.author.name }}</a>
            on {{ post.date }}
          </span>

          {% if post.reading_time %}
            <div class="wf-reading-time" aria-label="Estimated reading time">
              <svg viewBox="0 0 24 24" class="wf-reading-hourglass" aria-hidden="true">
                <g fill="none" stroke="currentColor" stroke-width="1.5"
                   stroke-linecap="round" stroke-linejoin="round">
                  <!-- Top bar -->
                  <path d="M6 3.5h12c.7 0 1.2.5 1.2 1.2v1c0 .7-.5 1.3-1.2 1.3H6C5.3 7 4.8 6.4 4.8 5.7v-1C4.8 4 5.3 3.5 6 3.5z"/>
                  <!-- Bottom bar -->
                  <path d="M6 17h12c.7 0 1.2.5 1.2 1.2v1c0 .7-.5 1.3-1.2 1.3H6c-.7 0-1.2-.6-1.2-1.3v-1C4.8 17.5 5.3 17 6 17z"/>
                  <!-- Outer glass shape -->
                  <path d="M8 7.3l4 4.2 4-4.2M8 16.7l4-4.2 4 4.2"/>
                  <!-- Sand top -->
                  <path d="M10 8.4h4L12 10.3z"/>
                  <!-- Sand stream -->
                  <path d="M12 10.6v2.4"/>
                  <!-- Sand bottom -->
                  <path d="M12 13.8l2 2.1h-4z"/>
                </g>
              </svg>
              <span class="wf-reading-text">
                {{ post.reading_time }} min
              </span>
            </div>
          {% endif %}



        </div>
      </div>
    </div>
  </div>
</header>

<!-- Post Content -->
<article>
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-12 col-md-11 col-lg-9 col-xl-9">
        <div class="post-body ck-content">
          {{ post.body|safe }}
        </div>

        <!-- Sources (collapsible) -->
        <div class="wf-sources my-4">
          <button
            class="wf-sources-toggle"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#sources-{{ post.id }}"
            aria-expanded="false"
            aria-controls="sources-{{ post.id }}">
            <span class="label">ðŸ”— Sources</span>
            <span class="chev" aria-hidden="true">â–¾</span>
          </button>

          <div id="sources-{{ post.id }}" class="collapse mt-2">
            {% if post.sources and post.sources|length > 0 %}
              <ul class="wf-sources-list mb-0">
                {% for s in post.sources %}
                  <li>
                    {% if s.url %}
                      <a class="wf-source-link" href="{{ s.url }}" target="_blank" rel="nofollow noopener">
                        {{ s.label }}
                      </a>
                    {% else %}
                      <span class="wf-source-plain">{{ s.label }}</span>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <div class="text-muted small">No sources provided for this article.</div>
            {% endif %}
          </div>
        </div>



        {% if current_user.id == 1 %}
        <div class="d-flex justify-content-end mb-4">
          <a class="btn btn-primary float-right" href="{{ url_for('edit_post', post_id=post.id) }}">Edit Post</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</article>

{% include "footer.html" %}
